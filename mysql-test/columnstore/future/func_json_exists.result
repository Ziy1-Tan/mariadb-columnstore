DROP DATABASE IF EXISTS json_exists_db;
CREATE DATABASE json_exists_db;
USE json_exists_db;
# ----------------------------------------------------------------------
# Test of JSON_EXISTS function.
# ----------------------------------------------------------------------
# Test case 0
CREATE TABLE t1(l LONGTEXT) ENGINE = columnstore;
INSERT INTO t1 VALUES('{"key1":"xxxx", "key2":[1, 2, 3]}');
INSERT INTO t1 VALUES('{"key1":"xxxx", "key2":[1, 2, 3],"key3":"value3"}');
SELECT JSON_EXISTS(l, "$.key1") FROM t1;
JSON_EXISTS(l, "$.key1")
1
1
SELECT JSON_EXISTS(l, "$.key2") FROM t1;
JSON_EXISTS(l, "$.key2")
1
1
SELECT JSON_EXISTS(l, "$.key2[1]") FROM t1;
JSON_EXISTS(l, "$.key2[1]")
1
1
SELECT JSON_EXISTS(l, "$.key2[10]") FROM t1;
JSON_EXISTS(l, "$.key2[10]")
0
0
SELECT JSON_EXISTS(l, "$.key3") FROM t1;
JSON_EXISTS(l, "$.key3")
0
1
# Test case 1
TRUNCATE t1;
SET @json='{
            "A": [0,
                  [1, 2, 3],
                  [4, 5, 6],
                  "seven",
                   0.8,
                   true,
                   false,
                   "eleven",
                  [12, 13, {"key1":"value1"},[15]],
                  true],
            "B": {"C": 1},
            "D": 2
           }';
INSERT INTO t1 VALUES(@json);
SELECT JSON_EXISTS(l, '$.A[-2][-1]') FROM t1;
JSON_EXISTS(l, '$.A[-2][-1]')
NULL
SELECT JSON_EXISTS(l, '$.A[last-1][last]') FROM t1;
JSON_EXISTS(l, '$.A[last-1][last]')
NULL
# Test case 2
TRUNCATE t1;
SET @json= '[
             [1, {"key1": "value1"}, 3],
             [false, 5, 6],
             [7, 8, [9, {"key2": 2}, 11]],
             [15, 1.34, [14], ["string1", [16, {"key1":[1,2,3,[4,5,6]]}, 18]]],
             [19, 20],
             21, 22
            ]';
INSERT INTO t1 VALUES(@json);
SELECT JSON_EXISTS(l, '$[3][3][-2 to last]') FROM t1;
JSON_EXISTS(l, '$[3][3][-2 to last]')
NULL
# Test case 3
TRUNCATE t1;
SET @json= '[
             [1, {"key1": "value1"}, 3],
             [false, 5, 6],
             [7, 8, [9, {"key2": 2}, 11]],
             [15, 1.34, [14], ["string1", [16, {"key1":[1,2,3,[4,5,6]]}, 18]]],
             [19, 20],
             21, 22
            ]';
INSERT INTO t1 VALUES(@json);
SELECT JSON_EXISTS(l, '$[2][2][1 to 2]') from t1;
JSON_EXISTS(l, '$[2][2][1 to 2]')
NULL
SELECT JSON_EXISTS(l, '$[2][2][4 to 6]') from t1;
JSON_EXISTS(l, '$[2][2][4 to 6]')
NULL
SELECT JSON_EXISTS(l, '$[2][2][1 to 4]') from t1;
JSON_EXISTS(l, '$[2][2][1 to 4]')
NULL
DROP TABLE t1;
DROP DATABASE json_exists_db;
